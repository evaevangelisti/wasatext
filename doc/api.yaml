openapi: 3.0.3

info:
    title: WASAText
    description: |-
        Connect with your friends effortlessly using WASAText! Send and receive messages, whether one-on-one
        or in groups, all from the convenience of your PC. Enjoy seamless conversations with text or GIFs and
        easily stay in touch through your private chats or group discussions.
    version: 1.0.0

servers:
    - url: http://localhost:8080/v1

tags:
    - name: users
      description: Users related operations

paths:
    /users:
        get:
            operationId: getUsers
            summary: Retrieves a list of users
            description: |-
                This endpoint retrieves a list of users.
                You can filter the users by providing a search term.
            tags:
                - users
            parameters:
                - name: q
                  in: query
                  required: false
                  description: Search term for filtering users
                  schema:
                      type: string
                      minLength: 1
                      maxLength: 16
                      pattern: "^.*$"
                      example: Maria
                      description: Search term for filtering users
                - $ref: "#/components/parameters/cursor"
                - $ref: "#/components/parameters/limit"
            responses:
                "200":
                    description: Successful response with a list of users
                    content:
                        application/json:
                            schema:
                                type: object
                                description: A list of users
                                properties:
                                    users:
                                        type: array
                                        minItems: 0
                                        maxItems: 128
                                        description: A list of users
                                        items:
                                            type: object
                                            description: User information
                                            properties:
                                                userId:
                                                    $ref: "#/components/schemas/UserId"
                                                username:
                                                    $ref: "#/components/schemas/Username"
                                                photo:
                                                    $ref: "#/components/schemas/Photo"
                                                displayName:
                                                    $ref: "#/components/schemas/DisplayName"
                                            required:
                                                - userId
                                                - username
                                                - displayName
                                    nextCursor:
                                        $ref: "#/components/schemas/Cursor"
                                required:
                                    - users
                            example:
                                users:
                                    - userId: "550e8400-e29b-41d4-a716-446655440000"
                                      username: Maria
                                      photo: "http://localhost:8080/images/profile-pictures/550e8400-e29b-41d4-a716-446655440000.jpg"
                                      displayName: Maria Rossi
                                nextCursor: "abc123XYZ"
                "400":
                    $ref: "#/components/responses/BadRequest"
                "401":
                    $ref: "#/components/responses/Unauthorized"
                "500":
                    $ref: "#/components/responses/InternalServerError"
        post:
            operationId: doLogin
            summary: Logs in the user
            description: |-
                If the user does not exist, it will be created,
                and the user is returned.
                If the user exists, the user is returned
            tags:
                - users
            requestBody:
                description: User details
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            description: User login information
                            properties:
                                username:
                                    $ref: "#/components/schemas/Username"
                            required:
                                - username
            responses:
                "201":
                    description: User log-in action successful
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/User"
                            example:
                                userId: "550e8400-e29b-41d4-a716-446655440000"
                                username: Maria
                                photo: "http://localhost:8080/images/profile-pictures/550e8400-e29b-41d4-a716-446655440000.jpg"
                                displayName: Maria Rossi
                                description: A passionate software developer
                                createdAt: "2025-01-01T12:00:00Z"
                "400":
                    $ref: "#/components/responses/BadRequest"
                "500":
                    $ref: "#/components/responses/InternalServerError"

    /users/{userId}:
        get:
            operationId: getUserProfile
            summary: Retrieves a user's profile
            description: |-
                This endpoint retrieves a user's profile by their userId.
                The userId must be a valid UUID.
            tags:
                - users
            parameters:
                - $ref: "#/components/parameters/userId"
            responses:
                "200":
                    description: Successful response with user profile
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/User"
                            example:
                                userId: "550e8400-e29b-41d4-a716-446655440000"
                                username: Maria
                                photo: "http://localhost:8080/images/profile-pictures/550e8400-e29b-41d4-a716-446655440000.jpg"
                                displayName: Maria Rossi
                                description: A passionate software developer
                                createdAt: "2025-01-01T12:00:00Z"
                "400":
                    $ref: "#/components/responses/BadRequest"
                "401":
                    $ref: "#/components/responses/Unauthorized"
                "404":
                    $ref: "#/components/responses/NotFound"
                "500":
                    $ref: "#/components/responses/InternalServerError"

    /me:
        delete:
            operationId: deleteMyUserProfile
            summary: Deletes the user's profile
            description: |-
                This endpoint deletes the user's profile.
                The user must be authenticated to perform this action.
            tags:
                - users
            security:
                - BearerAuth: []
            responses:
                "204":
                    description: User profile deleted successfully
                "401":
                    $ref: "#/components/responses/Unauthorized"
                "404":
                    $ref: "#/components/responses/NotFound"
                "500":
                    $ref: "#/components/responses/InternalServerError"

    /me/username:
        patch:
            operationId: setMyUsername
            summary: Updates the user's username
            description: |-
                This endpoint updates the user's username.
                The user must be authenticated to perform this action.
            tags:
                - users
            requestBody:
                description: New username
                required: true
                content:
                    application/merge-patch+json:
                        schema:
                            type: object
                            description: New username
                            properties:
                                username:
                                    $ref: "#/components/schemas/Username"
            security:
                - BearerAuth: []
            responses:
                "200":
                    description: Username updated successfully
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/User"
                            example:
                                userId: "550e8400-e29b-41d4-a716-446655440000"
                                username: Maria
                                photo: "http://localhost:8080/images/profile-pictures/550e8400-e29b-41d4-a716-446655440000.jpg"
                                displayName: Maria Rossi
                                description: A passionate software developer
                                createdAt: "2025-01-01T12:00:00Z"
                "400":
                    $ref: "#/components/responses/BadRequest"
                "401":
                    $ref: "#/components/responses/Unauthorized"
                "500":
                    $ref: "#/components/responses/InternalServerError"

    /me/photo:
        patch:
            operationId: setMyPhoto
            summary: Updates the user's profile photo
            description: |-
                This endpoint updates the user's profile photo.
                The user must be authenticated to perform this action.
            tags:
                - users
            requestBody:
                description: New profile photo
                required: true
                content:
                    application/merge-patch+json:
                        schema:
                            type: object
                            description: New profile photo
                            properties:
                                photo:
                                    $ref: "#/components/schemas/Photo"
            security:
                - BearerAuth: []
            responses:
                "200":
                    description: Profile photo updated successfully
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/User"
                            example:
                                userId: "550e8400-e29b-41d4-a716-446655440000"
                                username: Maria
                                photo: "http://localhost:8080/images/profile-pictures/550e8400-e29b-41d4-a716-446655440000.jpg"
                                displayName: Maria Rossi
                                description: A passionate software developer
                                createdAt: "2025-01-01T12:00:00Z"
                "400":
                    $ref: "#/components/responses/BadRequest"
                "401":
                    $ref: "#/components/responses/Unauthorized"
                "500":
                    $ref: "#/components/responses/InternalServerError"

    /me/display_name:
        patch:
            operationId: setMyDisplayName
            summary: Updates the user's display name
            description: |-
                This endpoint updates the user's display name.
                The user must be authenticated to perform this action.
            tags:
                - users
            requestBody:
                description: New display name
                required: true
                content:
                    application/merge-patch+json:
                        schema:
                            type: object
                            description: New display name
                            properties:
                                displayName:
                                    $ref: "#/components/schemas/DisplayName"
            security:
                - BearerAuth: []
            responses:
                "200":
                    description: Display name updated successfully
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/User"
                            example:
                                userId: "550e8400-e29b-41d4-a716-446655440000"
                                username: Maria
                                photo: "http://localhost:8080/images/profile-pictures/550e8400-e29b-41d4-a716-446655440000.jpg"
                                displayName: Maria Rossi
                                description: A passionate software developer
                                createdAt: "2025-01-01T12:00:00Z"
                "400":
                    $ref: "#/components/responses/BadRequest"
                "401":
                    $ref: "#/components/responses/Unauthorized"
                "500":
                    $ref: "#/components/responses/InternalServerError"

    /me/description:
        patch:
            operationId: setMyDescription
            summary: Updates the user's description
            description: |-
                This endpoint updates the user's description.
                The user must be authenticated to perform this action.
            tags:
                - users
            requestBody:
                description: New description
                required: true
                content:
                    application/merge-patch+json:
                        schema:
                            type: object
                            description: New description
                            properties:
                                description:
                                    $ref: "#/components/schemas/Description"
            security:
                - BearerAuth: []
            responses:
                "200":
                    description: Description updated successfully
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/User"
                            example:
                                userId: "550e8400-e29b-41d4-a716-446655440000"
                                username: Maria
                                photo: "http://localhost:8080/images/profile-pictures/550e8400-e29b-41d4-a716-446655440000.jpg"
                                displayName: Maria Rossi
                                description: A passionate software developer
                                createdAt: "2025-01-01T12:00:00Z"
                "400":
                    $ref: "#/components/responses/BadRequest"
                "401":
                    $ref: "#/components/responses/Unauthorized"
                "500":
                    $ref: "#/components/responses/InternalServerError"

components:
    schemas:
        User:
            type: object
            description: Represents a user in the system
            properties:
                userId:
                    $ref: "#/components/schemas/UserId"
                username:
                    $ref: "#/components/schemas/Username"
                photo:
                    $ref: "#/components/schemas/Photo"
                displayName:
                    $ref: "#/components/schemas/DisplayName"
                description:
                    $ref: "#/components/schemas/Description"
                createdAt:
                    type: string
                    format: date-time
                    minLength: 20
                    maxLength: 20
                    example: "2025-01-01T12:00:00Z"
                    description: The date and time when the user account was created
            required:
                - userId
                - username
                - displayName
                - createdAt

        UserId:
            type: string
            format: uuid
            minLength: 36
            maxLength: 36
            pattern: "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"
            example: "550e8400-e29b-41d4-a716-446655440000"
            description: Unique identifier for the user

        Username:
            type: string
            minLength: 3
            maxLength: 16
            pattern: "^[a-zA-Z0-9._-]+$"
            example: Maria
            description: The user's chosen display name

        Photo:
            type: string
            minLength: 83
            maxLength: 87
            pattern: "^http://(localhost|127\\.0\\.0\\.1):[0-9]{1,5}/images/profile-pictures/[0-9a-fA-F\\-]{36}\\.jpg$"
            example: "http://localhost:8080/images/profile-pictures/550e8400-e29b-41d4-a716-446655440000.jpg"
            description: URL to the user's profile picture

        DisplayName:
            type: string
            minLength: 1
            maxLength: 32
            pattern: "^.*$"
            example: Maria Rossi
            description: User's display name

        Description:
            type: string
            minLength: 0
            maxLength: 128
            pattern: "^.*$"
            example: A passionate software developer
            description: A short description of the user

        Cursor:
            type: string
            minLength: 8
            maxLength: 128
            pattern: "^[a-zA-Z0-9_-]+$"
            example: "abc123XYZ"
            description: Cursor for pagination

        Error:
            type: object
            description: Represents an error response from the API
            properties:
                code:
                    type: string
                    minLength: 9
                    maxLength: 16
                    pattern: "^ERR-[0-9]{3}-[A-Z]+$"
                    example: "ERR-404-USER"
                    description: A unique error code representing the type of error
                message:
                    type: string
                    minLength: 1
                    maxLength: 256
                    pattern: "^.*$"
                    example: User not found
                    description: A human-readable message providing more details about the error
            required:
                - code
                - message

    parameters:
        userId:
            name: userId
            in: path
            required: true
            description: Unique identifier for the user
            schema:
                $ref: "#/components/schemas/UserId"

        cursor:
            name: cursor
            in: query
            required: false
            description: Cursor for pagination
            schema:
                $ref: "#/components/schemas/Cursor"

        limit:
            name: limit
            in: query
            required: false
            description: Maximum number of items to return
            schema:
                type: integer
                minimum: 1
                maximum: 128
                default: 32
                description: Maximum number of items to return

    securitySchemes:
        BearerAuth:
            type: http
            scheme: bearer
            bearerFormat: userId

    responses:
        BadRequest:
            description: The request could not be understood or was missing required parameters
            content:
                application/json:
                    schema:
                        $ref: "#/components/schemas/Error"

        Unauthorized:
            description: Authentication failed or user does not have permissions for the desired action
            content:
                application/json:
                    schema:
                        $ref: "#/components/schemas/Error"

        Forbidden:
            description: Authentication succeeded but authenticated user does not have access to the requested resource
            content:
                application/json:
                    schema:
                        $ref: "#/components/schemas/Error"

        NotFound:
            description: The requested resource could not be found
            content:
                application/json:
                    schema:
                        $ref: "#/components/schemas/Error"

        InternalServerError:
            description: An error occurred on the server
            content:
                application/json:
                    schema:
                        $ref: "#/components/schemas/Error"
